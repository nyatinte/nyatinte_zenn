---
title: 'ChakraUIã¨React-Hook-Formã§æ´»ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚‹'
emoji: 'ğŸ™'
type: 'tech'
topics:
  - 'nextjs'
  - 'react'
  - 'reacthookform'
  - 'chakraui'
  - 'zod'
published: true
published_at: '2022-11-23 20:58'
---

# ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

- [ChakraUI](https://chakra-ui.com/)ã§[React-Hook-Form](https://react-hook-form.com/)(ä»¥ä¸‹ RHF)ã‚’ä½¿ã†æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™

https://chakra-ui.com/getting-started/with-hook-form

ã“ã¡ã‚‰ã¯ chakra å…¬å¼ãŒç´¹ä»‹ã—ã¦ã„ã‚‹ RHF ã®ä½¿ç”¨æ³•ã§ã™

```tsx
import { useForm } from 'react-hook-form';
import {
  FormErrorMessage,
  FormLabel,
  FormControl,
  Input,
  Button,
} from '@chakra-ui/react';

export default function HookForm() {
  const {
    handleSubmit,
    register,
    formState: { errors, isSubmitting },
  } = useForm();

  function onSubmit(values) {
    return new Promise((resolve) => {
      setTimeout(() => {
        alert(JSON.stringify(values, null, 2));
        resolve();
      }, 3000);
    });
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <FormControl isInvalid={errors.name}>
        <FormLabel htmlFor='name'>First name</FormLabel>
        <Input
          id='name'
          placeholder='name'
          {...register('name', {
            required: 'This is required',
            minLength: { value: 4, message: 'Minimum length should be 4' },
          })}
        />
        <FormErrorMessage>
          {errors.name && errors.name.message}
        </FormErrorMessage>
      </FormControl>
      <Button mt={4} colorScheme='teal' isLoading={isSubmitting} type='submit'>
        Submit
      </Button>
    </form>
  );
}
```

ãƒ©ãƒ™ãƒ«ã¨å…¥åŠ›æ¬„ã®éƒ¨åˆ†ã¯ã“ã“ã«ãªã‚Šã¾ã™

```tsx: æŠœç²‹
      <FormControl isInvalid={errors.name}>
        <FormLabel htmlFor='name'>First name</FormLabel>
        <Input
          id='name'
          placeholder='name'
          {...register('name', {
            required: 'This is required',
            minLength: { value: 4, message: 'Minimum length should be 4' },
          })}
        />
        <FormErrorMessage>
          {errors.name && errors.name.message}
        </FormErrorMessage>
      </FormControl>
```

ã“ã‚Œã‚’`name`, `email`, `password`...ã®ã‚ˆã†ã«å¹¾ã¤ã‚‚ä¸¦ã¹ã‚‹ã¨å¯èª­æ€§ãŒå¤§ããä¸‹ãŒã£ã¦ã—ã¾ã„ã¾ã™

ã¨ã„ã†ã“ã¨ã§ã€ã“ã‚Œã‚’æ´»ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã—ã¦ã—ã¾ã„ã¾ã™

# å®Œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```tsx:components/Input/ContorolledInput.tsx
import {
  FormControl,
  FormLabel,
  Input,
  FormErrorMessage,
  InputProps,
  forwardRef,
  FormControlProps,
  FormLabelProps,
  FormErrorMessageProps,
} from '@chakra-ui/react';
import { FieldErrorsImpl, Ref } from 'react-hook-form';

export type ControlledInputProps = {
  label: string;
  errors: Partial<FieldErrorsImpl<Record<string, unknown>>>;
  name: string;
  ref: Ref;
  isRequired?: boolean;
  formControlProps?: Omit<FormControlProps, 'isInvalid' | 'isRequired'>;
  formLabelProps?: FormLabelProps;
  formErrorMessageProps?: FormErrorMessageProps;
} & Omit<InputProps, 'isRequired'>;

export const ControlledInput = forwardRef<ControlledInputProps, 'input'>(
  (
    {
      label,
      errors,
      name,
      isRequired,
      formControlProps,
      formLabelProps,
      formErrorMessageProps,
      ...rest
    }: Omit<ControlledInputProps, 'ref'>,
    ref
  ) => {
    return (
      <FormControl
        isInvalid={Boolean(errors[name])}
        isRequired={isRequired}
        {...formControlProps}
      >
        <FormLabel {...formLabelProps}>{label}</FormLabel>
        <Input name={name} {...rest} ref={ref} />
        <FormErrorMessage {...formErrorMessageProps}>
          {errors[name]?.message}
        </FormErrorMessage>
      </FormControl>
    );
  }
);
```

## ä½¿ç”¨ä¾‹

```tsx: nextjsã§æ›¸ãã¾ã—ãŸ
import { Button, Container, Textarea } from '@chakra-ui/react';
import { zodResolver } from '@hookform/resolvers/zod';
import { NextPage } from 'next';
import { SubmitHandler, useForm } from 'react-hook-form';
import { z } from 'zod';
import { ControlledInput } from '../components/Input/ControlledInput';

export const schema = z.object({
  name: z.string().min(3, 'åå‰ã¯3æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  email: z.string().email('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'),
  password: z.string().min(8, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  description: z
    .string()
    .max(100, 'è‡ªå·±ç´¹ä»‹ã¯100æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„')
    .optional(),
});
export type FormValues = z.infer<typeof schema>;
const Page: NextPage = () => {
  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
  });
  const onSubmit: SubmitHandler<FormValues> = (form) => {
    console.log(form);
    reset();
  };
  return (
    <Container as='form' p='10' boxShadow='md' borderRadius='md'>
      <ControlledInput
        label='ãƒ¦ãƒ¼ã‚¶ãƒ¼å'
        errors={errors}
        isRequired
        {...register('name')}
      />
      <ControlledInput
        label='ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'
        type='email'
        errors={errors}
        isRequired
        {...register('email')}
      />
      <ControlledInput
        label='ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'
        errors={errors}
        isRequired
        type='password'
        {...register('password')}
      />
      <ControlledInput
        label='è‡ªå·±ç´¹ä»‹'
        errors={errors}
        as={Textarea}
        {...register('description')}
      />
      <Button onClick={handleSubmit(onSubmit)}>é€ä¿¡</Button>
    </Container>
  );
};

export default Page;
```

## å‡ºåŠ›

![](https://storage.googleapis.com/zenn-user-upload/2bc8f94a3b9c-20221123.png)

# è§£èª¬

:::details ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¤ã„ã¦

### `ref`ã‚’ã©ã†ã‚„ã£ã¦æ¸¡ã™ã‹

RHF ã®[`register`](https://react-hook-form.com/api/useform/register)ã¯

`(name: string, RegisterOptions?) => ({ onChange, onBlur, name, ref })`

ã®å‹ã«ãªã£ã¦ã„ã¾ã™

ã“ã“ã«`ref`ãŒã‚ã‚‹ã®ã§ã™ãŒã€**ãã®ã¾ã¾ props ã§`ref={ref}`ã®æ§˜ã«æ¸¡ã›ã¾ã›ã‚“ã€‚**

https://zenn.dev/terrierscript/scraps/15ca11388f7424

ãªãœã‹ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™

ã§ã€ã©ã†ã™ã‚Œã°ã„ã„ã‹ã¨ã„ã†ã¨[`forwordRef`](https://chakra-ui.com/community/recipes/as-prop#option-1-using-forwardref-from-chakra-uireact)ã‚’ä½¿ã£ã¦ã„ã„æ„Ÿã˜ã«æ¸¡ã—ã¦ã‚‚ã‚‰ã„ã¾ã™

```tsx
export const ControlledInput = forwardRef<ControlledInputProps, 'input'>(
  (
    {
      label,
      errors,
      name,
      isRequired,
      formControlProps,
      formLabelProps,
      formErrorMessageProps,
      ...rest
    }: Omit<ControlledInputProps, 'ref'>,
    ref
  ) => {
    return (
    ...
```

ã“ã®éƒ¨åˆ†ã§ã™
props ãŒ`(props, ref)`ã¨ã„ã†å‹ã§æ¸¡ã•ã‚Œã‚‹ã®ã§ã€ã“ã‚Œã‚’å—ã‘å–ã‚Šã¾ã™ã€‚
ã‚ã¨ã¯`Input`ã«`ref={ref}`ã§æ¸¡ã›ã° OK ã§ã™
:::

:::details ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ©ç”¨
ã†ã¾ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã§ããŸã®ã§ã€æ™®æ®µä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

```tsx
<ControlledInput
  label='ãƒ¦ãƒ¼ã‚¶ãƒ¼å'
  errors={errors}
  isRequired
  {...register('name')}
/>
```

`errors`ã¨`label`ã¯ç‹¬è‡ªã®ã‚‚ã®ã§ã™ãŒã€`{...register('name')}`ã¨ã„ã†è¨˜æ³•ã¯ã„ã¤ã‚‚ã®ã‚‚ã®ã§ã™ã­ã€‚

ã¾ãŸã€`InputProps`ä¸­ã®å±æ€§`type`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„ãƒ¡ãƒ¼ãƒ«ã€æ•°å€¤å‹ã‚‚å¯¾å¿œã§ãã¾ã™

```tsx:type='password'
<ControlledInput
  label='ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'
  errors={errors}
  isRequired
  type='password'
  {...register('password')}
/>
```

ãã‚Œã ã‘ã§ãªãã€chakra ã®`as`ã‚’æ´»ç”¨ã™ã‚‹ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æ‰±ãˆã¾ã™

```tsx:as={Textarea}
<ControlledInput
  label='è‡ªå·±ç´¹ä»‹'
  errors={errors}
  as={Textarea}
  {...register('description')}
/>
```

ã‹ãªã‚Šæ´»ç”¨çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãªã‚Šã¾ã—ãŸã­ã€‚ã‚ã¨ã¯ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å‡ã‚‹ãªã©ã™ã‚Œã°ãã‚Œãªã‚Šã«ä½¿ãˆã‚‹ã‚‚ã®ã«ãªã‚‹ã¨æ€ã„ã¾ã™
:::

:::details zod ã®åˆ©ç”¨
validation ã¨ã—ã¦[`zod`](https://github.com/colinhacks/zod)ã‚’ä½¿ç”¨ã—ã¾ã—ãŸ

```tsx
export const schema = z.object({
  name: z.string().min(3, 'åå‰ã¯3æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  email: z.string().email('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'),
  password: z.string().min(8, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  description: z
    .string()
    .max(100, 'è‡ªå·±ç´¹ä»‹ã¯100æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„')
    .optional(),
});

...

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
  });

  ...
```

zod ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€validation ã‚’ jsx ã®ç®‡æ‰€ã§ã¯ãªãã€å¤–éƒ¨ã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ§‹æˆãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚

ã‚‚ã¡ã‚ã‚“ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ã‚‚ã•ã¾ã–ã¾ãªæ©Ÿèƒ½ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€éå¸¸ã«ä½¿ã„å‹æ‰‹ãŒã„ã„ã§ã™ã€‚
ç‰¹ã« transform ã§ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å¤‰å½¢ã§ãã‚‹ã®ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒã„ã„ã§ã™ã­

https://zenn.dev/uttk/articles/bd264fa884e026#transformer-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6

ã“ã¡ã‚‰ã®è¨˜äº‹ãŒã¨ã¦ã‚‚ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™
:::

# æœ€å¾Œã«

ã“ã“ã¾ã§ã”è¦§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

æœ¬è¨˜äº‹ã¯ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã‚‚ãªã‚“ã§ã‚‚ãªã„ã§ã™ãŒã€chakra ã¨ RHF ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã®è¨˜äº‹ãŒè¦‹å½“ãŸã‚‰ãªã„ã®ã§ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚

é–“é•ã„ã‚„ã‚‚ã£ã¨ã“ã†ã—ãŸæ–¹ãŒã„ã„ã‚ˆï¼ç­‰ã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚„ Twitter ã® DM ã§æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ï¼
