---
title: "prisma-fabbricaã‚’vitest-environment-vprismaã§ä½¿ã†ãŸã‚ã®SetUp"
emoji: "ğŸ­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [prisma,vitest,testing]
published: true
---

[prisma-fabbrica](https://github.com/Quramy/prisma-fabbrica)ã¯ã€Prismaã®ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã§ã‚ã‚Šã€`schema.prisma`ã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§ã€ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚„ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚’ç°¡å˜ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

https://github.com/Quramy/prisma-fabbrica

[vitest-environment-vprisma](https://github.com/aiji42/vitest-environment-vprisma)ã¯ã€Prismaã¨Vitestã‚’çµ„ã¿åˆã‚ã›ãŸãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§åˆ†é›¢ã—ã€ãƒ†ã‚¹ãƒˆã®å®Œäº†å¾Œã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã‚’æ’é™¤ã—ã¾ã™ã€‚

https://github.com/aiji42/vitest-environment-vprisma

vitest-environment-vprismaã¯ã€prisma-fabbricaã®ä½œè€…ã§ã‚ã‚‹Quramyã•ã‚“ãŒä½œæˆã—ãŸ[jest-prisma](https://github.com/Quramy/jest-prisma)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/Quramy/jest-prisma

jest-prismaã§ã¯ã€[Tips > Works with jest-prisma](https://github.com/Quramy/prisma-fabbrica?tab=readme-ov-file#works-with-jest-prisma)ã«jest-prismaã¨prisma-fabbricaã‚’çµ„ã¿åˆã‚ã›ã‚‹ãŸã‚ã®è¨­å®šãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ãŒã€vitest-environment-vprismaã«å‘ã‘ãŸè¨­å®šã¯è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ãã“ã§ã€æœ¬è¨˜äº‹ã§ã¯ã€vitest-environment-vprismaã‚’ä½¿ã†éš›ã®prisma-fabbricaã®è¨­å®šæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## SetUp

vitest-environment-vprismaã®åŸºæœ¬çš„ãªè¨­å®šã«åŠ ãˆã¦ã€setUpFileã¨ã—ã¦`vitest.setup.ts`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts:vitest.config.ts
import { defineConfig } from "vite";

export default defineConfig({
  test: {
    globals: true,
    environment: "vprisma",
    setupFiles: ["vitest-environment-vprisma/setup", "vitest.setup.ts"] // vitest.setup.tsã‚’è¿½åŠ 
  },
});
```

`vitest.setup.ts`ã«prisma-fabbricaã®è¨­å®šã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```ts:vitest.setup.ts
import { initialize, resetSequence } from "./__generated__/fabbrica";

beforeAll(() => {
  initialize({
    prisma: () => vPrisma.client,
  });
});

beforeEach(() => resetSequence());
```

ã“ã®è¨­å®šã¯ã€prisma-fabbricaã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«å«ã¾ã‚Œã‚‹jest-prismaå‘ã‘ã®è¨­å®šã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

https://github.com/Quramy/prisma-fabbrica/blob/main/packages/prisma-fabbrica/src/scripts/jest-prisma/setup.ts

ä»¥ä¸Šã®è¨­å®šã«ã‚ˆã‚Šã€vitest-environment-vprismaã¨prisma-fabbricaã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
